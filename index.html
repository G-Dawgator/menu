<script>
  const meals = [
    "Curry chicken",
    "Gratin courgettes",
    "Gratin patates",
    "Lasagne",
    "Sommerrolle",
    "Galettes",
    "Croque monsieur",
    "Ratatouille",
    "Risotto",
    "Poulet frite",
    "LÃ©gumes au four",
    "Soupe lÃ©gume",
    "Soupe Pho",
    "Salade Vietnamienne",
    "Burrito",
    "Tatar saumon",
    "Tatar thon",
    "Gartin broccoli",
    "Rice bowl saumon",
    "Rice bowl poulet",
    "Tomate farcies",
    "Poisson mÃ©mÃ©",
    "Patates Ã  la pÃ©pÃ©",
    "Salade composÃ©e",
    "Soupe concombre",
    "Caleloni"
  ];

  // â­ Repas incontournables (au moins 1 fois par semaine)
  const mandatoryMeals = [
    "PÃ¢tes"
  ];

  function getMonday(date) {
    const d = new Date(date);
    const day = d.getDay() || 7;
    if (day !== 1) d.setDate(d.getDate() - (day - 1));
    return d;
  }

  function formatDate(d) {
    return d.toLocaleDateString('fr-FR');
  }

  function getWeekNumber(d) {
    const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    const dayNum = date.getUTCDay() || 7;
    date.setUTCDate(date.getUTCDate() + 4 - dayNum);
    const yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));
    return Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
  }

  function generateMenu() {
    const menuDiv = document.getElementById('menu');
    menuDiv.innerHTML = "";

    const now = new Date();
    const monday = getMonday(now);
    const sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);

    const weekNumber = getWeekNumber(monday);

    document.getElementById('week').textContent =
      `Semaine ${weekNumber} â€“ du ${formatDate(monday)} au ${formatDate(sunday)}`;

    const days = [
      "Lundi",
      "Mardi",
      "Mercredi",
      "Jeudi",
      "Vendredi",
      "Samedi",
      "Dimanche"
    ];

    const menu = {};
    const availableDays = [...days];

    // 1ï¸âƒ£ Placer les repas incontournables
    mandatoryMeals.forEach(meal => {
      const randomIndex = Math.floor(Math.random() * availableDays.length);
      const day = availableDays.splice(randomIndex, 1)[0];
      menu[day] = meal;
    });

    // 2ï¸âƒ£ Pizza un dimanche sur deux (si le dimanche est libre)
    if (weekNumber % 2 === 0 && !menu["Dimanche"]) {
      menu["Dimanche"] = "ðŸ• Pizza";
      const index = availableDays.indexOf("Dimanche");
      if (index > -1) availableDays.splice(index, 1);
    }

    // 3ï¸âƒ£ ComplÃ©ter les autres jours
    availableDays.forEach(day => {
      const usedMeals = Object.values(menu);
      const possibleMeals = meals.filter(m => !usedMeals.includes(m));
      menu[day] = possibleMeals[Math.floor(Math.random() * possibleMeals.length)];
    });

    // 4ï¸âƒ£ Affichage
    days.forEach(day => {
      const div = document.createElement('div');
      div.className = 'day';
      div.innerHTML = `<span>${day}</span><div>${menu[day]}</div>`;
      menuDiv.appendChild(div);
    });
  }

  function refreshWeek() {
    generateMenu();
  }

  generateMenu();
</script>

