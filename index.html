<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Menu du soir</title>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #f4f6f8;
      color: #333;
    }
    header {
      background: #1E3A8A;
      color: white;
      padding: 20px;
      text-align: center;
    }
    h1 { margin: 0; }
    .container {
      padding: 16px;
      max-width: 520px;
      margin: auto;
    }
    .week {
      text-align: center;
      font-weight: bold;
      margin-bottom: 16px;
    }
    .day {
      background: white;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    }
    .day span { font-weight: 600; }
    .buttons {
      display: flex;
      margin-top: 16px;
    }
    button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      background: #1E3A8A;
      color: white;
    }
  </style>
</head>

<body>
  <header>
    <h1>üçΩÔ∏è Menu du soir</h1>
    <div>Famille Lafon</div>
  </header>

  <div class="container">
    <div class="week" id="week"></div>
    <div id="menu"></div>

    <div class="buttons">
      <button onclick="refreshWeek()">üîÑ Actualiser</button>
    </div>
  </div>

  <script>
    const meals = [
      "Curry chicken",
      "Gratin courgettes",
      "Gratin patates",
      "Lasagne",
      "Sommerrolle",
      "Galettes",
      "Croque monsieur",
      "Ratatouille",
      "Risotto",
      "Poulet frite",
      "L√©gumes au four",
      "Soupe l√©gume",
      "Soupe Pho",
      "Salade Vietnamienne",
      "Burrito",
      "Tatar saumon",
      "Tatar thon",
      "Gartin broccoli",
      "Rice bowl saumon",
      "Rice bowl poulet",
      "Tomate farcies",
      "Poisson m√©m√©",
      "Patates √† la p√©p√©",
      "Salade compos√©e",
      "Soupe concombre",
      "Caleloni",
      "P√¢tes"
    ];

    // ‚≠ê Repas incontournables (au moins 1 fois par semaine)
    // ‚ö†Ô∏è Mets ici des repas qui existent aussi dans "meals"
    const mandatoryMeals = [
      // Exemple: "Lasagne"
    ];

    function getMonday(date) {
      const d = new Date(date);
      const day = d.getDay() || 7;
      if (day !== 1) d.setDate(d.getDate() - (day - 1));
      return d;
    }

    function formatDate(d) {
      return d.toLocaleDateString('fr-FR');
    }

    function getWeekNumber(d) {
      const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      const dayNum = date.getUTCDay() || 7;
      date.setUTCDate(date.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));
      return Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
    }

    function generateMenu() {
      const menuDiv = document.getElementById('menu');
      menuDiv.innerHTML = "";

      const now = new Date();
      const monday = getMonday(now);
      const sunday = new Date(monday);
      sunday.setDate(monday.getDate() + 6);

      const weekNumber = getWeekNumber(monday);

      document.getElementById('week').textContent =
        `Semaine ${weekNumber} ‚Äì du ${formatDate(monday)} au ${formatDate(sunday)}`;

      const days = ["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];

      const menu = {};
      const availableDays = [...days];

      // 1) Placer les repas incontournables (si pr√©sents dans meals)
      mandatoryMeals
        .filter(m => meals.includes(m))
        .forEach(meal => {
          if (availableDays.length === 0) return;
          const randomIndex = Math.floor(Math.random() * availableDays.length);
          const day = availableDays.splice(randomIndex, 1)[0];
          menu[day] = meal;
        });

      // 2) Pizza un dimanche sur deux (si dimanche libre)
      if (weekNumber % 2 === 0 && !menu["Dimanche"]) {
        menu["Dimanche"] = "üçï Pizza";
        const idx = availableDays.indexOf("Dimanche");
        if (idx > -1) availableDays.splice(idx, 1);
      }

      // 3) Compl√©ter les autres jours sans doublons si possible
      availableDays.forEach(day => {
        const usedMeals = Object.values(menu);
        const possibleMeals = meals.filter(m => !usedMeals.includes(m));

        // si on a √©puis√© les repas uniques, on autorise les r√©p√©titions
        const pool = possibleMeals.length > 0 ? possibleMeals : meals;
        menu[day] = pool[Math.floor(Math.random() * pool.length)];
      });

      // 4) Affichage dans l'ordre
      days.forEach(day => {
        const div = document.createElement('div');
        div.className = 'day';
        div.innerHTML = `<span>${day}</span><div>${menu[day]}</div>`;
        menuDiv.appendChild(div);
      });
    }

    function refreshWeek() {
      generateMenu();
    }

    generateMenu();
  </script>
</body>
</html>
